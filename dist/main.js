(()=>{"use strict";function e(e){const t=e;t.currentTime=0,t.play()}function t(e,t,l,o,n){const s=e,a=t,c=l,r=o,u=n,d=s[a][c];s[a][c]=s[r][u],s[r][u]=d}const l=document.createElement("div"),o=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),r=document.createElement("div"),u=document.createElement("div"),d=document.createElement("div"),m=document.createElement("button"),i=document.createElement("button");i.textContent="Nums off",i.shows=!1,m.textContent="Close",d.textContent="Field size: ";const p=document.createElement("select");p.size="1",p.name="select-field",p.id="field-size";const g=document.createElement("option"),y=document.createElement("option"),S=document.createElement("option"),f=document.createElement("option"),v=document.createElement("option"),x=document.createElement("option");g.value="3",g.textContent="3x3",y.value="4",y.selected="true",y.textContent="4x4",S.value="5",S.textContent="5x5",f.value="6",f.textContent="6x6",v.value="7",v.textContent="7x7",x.value="8",x.textContent="8x8";const h=document.createElement("button");h.textContent="Start";const b=document.createElement("button");b.innerHTML='<img src = ./assets/sound-on.png alt="">';const I=document.createElement("button");I.textContent="Scores";const E=document.createElement("audio");let L,k;E.src="./assets/cell.wav",E.classList.add("cellSound"),document.body.append(E),l.classList.add("game"),o.classList.add("menu"),u.classList.add("form"),n.classList.add("statusbar"),n.textContent="Time passed: 00:00   Moves: 0",h.classList.add("start"),b.classList.add("volume"),m.classList.add("close-button"),I.classList.add("best-scores"),i.classList.add("nums-button"),r.classList.add("field"),c.classList.add("score-list"),document.body.append(l),l.append(o),c.append(m),document.body.prepend(c),o.append(n),n.append(s),n.append(a),o.append(u),u.append(d,p),p.append(g,y,S,f,v,x),u.append(h),o.append(b,I,i),l.append(r),localStorage.getItem("continue")&&(k=JSON.parse(localStorage.getItem("continue"))),I.addEventListener("click",(()=>{c.classList.toggle("open");let e=localStorage.getItem("results");e=JSON.parse(e);for(let t=0;t<e.length;t+=1){const l=document.createElement("span");l.classList.add("score-item"),l.textContent=`${t+1}. Moves:  ${e[t].score} Time: ${e[t].time}`,document.querySelector(".score-list").append(l)}})),m.addEventListener("click",(()=>{const e=c.querySelectorAll(".score-item");for(let t=0;t<e.length;t+=1)e[t].remove();c.classList.toggle("open")})),b.addEventListener("click",(()=>{const e=document.querySelector(".cellSound");e.muted=!1===e.muted&&!e.muted,!0===document.querySelector(".cellSound").muted?b.innerHTML='<img src="./assets/sound-off.png">':b.innerHTML='<img src="./assets/sound-on.png">'})),i.addEventListener("click",(()=>{if(i.shows=!i.shows,i.shows){i.textContent="Nums on";const e=document.querySelectorAll(".cell");for(const t of e)t.style.color="white"}else{i.textContent="Nums off";const e=document.querySelectorAll(".cell");for(const t of e)t.style.color="transparent"}}));let N=0,O=!1,$=[],q={value:"",left:0,top:0,element:null},J=100;const w=60;let C,M,T,A,z="",D=1,R=1,P=1,j=0,H=0,W=0;function X(){const e=new Date,t=e.getTime()-M.getTime()-1e3*j;window.addEventListener("unload",(()=>{const l=JSON.stringify([D,R,P,j,H,W,T,A,C,e,t,z]);localStorage.setItem("time",l)})),t>999&&(j+=1),j>=R*w?(H=0,R+=1):(H=parseInt(W/100+j,10),H>=w&&(H-=(R-1)*w)),R>D*w?(P=1,D+=1):(P=parseInt(W/100+R,10),P>=w&&(P-=(D-1)*w)),W=Math.round(t/10),W>99&&(W=0),0===W&&(W="00"),W>0&&W<=9&&(W="0"+W),H>0?(A=H,H<10&&(A="0"+H)):A="00",T=P-1,T>0?T<10&&(T="0"+T):T="00",z=`${T}:${A}`,n.textContent=`Time passed: ${z} Moves: ${N}`,C=setTimeout(X,1)}function Y(){clearTimeout(C),D=1,R=1,P=1,j=0,H=0,W=0,z="00:00",n.textContent=`Time passed: ${z} Moves: ${N}`}function F(){clearTimeout(C)}function V(){n.textContent=`Time passed: ${z} Moves: ${N}`}function B(){O=!1,F(),function(){let e=null;const t={score:N,time:z};if(localStorage.getItem("results")){localStorage.getItem("results"),e=localStorage.getItem("results"),e=JSON.parse(e);for(let l=0;l<e.length;l+=1){if(e[l].score>t.score){e.length>=10?(e.splice(10,1),e.splice(l,0,t),e=JSON.stringify(e),localStorage.setItem("results",e)):(e.splice(l,0,t),e=JSON.stringify(e),localStorage.setItem("results",e));break}if(e[l].score<t.score){if(e.length>=10)break;e.push(t),e=JSON.stringify(e),localStorage.setItem("results",e);break}if(e[l].score===t.score){if(e[l].time<t.time){e.length>=10?(e.splice(10,1),e.splice(l,0,t),e=JSON.stringify(e),localStorage.setItem("results",e)):(e.splice(l,0,t),e=JSON.stringify(e),localStorage.setItem("results",e));break}e.length,e.splice(l+1,0,t),e=JSON.stringify(e),localStorage.setItem("results",e);break}}}else e=[],e.push(t),e=JSON.stringify(e),localStorage.setItem("results",e)}(),alert(`Ура! Вы решили головоломку за ${z} и ${N} ходов`),function(){F(),Y();const e=document.querySelectorAll(".cell");document.querySelector(".emptycell").remove(),N=0,$=[];for(let t=0;t<e.length;t+=1)e[t].remove();h.textContent="Start",V()}()}function G(){document.body.clientWidth<=768?(J=35,document.querySelector(".cell")&&(document.querySelectorAll(".cell").forEach((e=>{const t=e;t.style.width="35px",t.style.height="35px"})),document.querySelector(".emptycell").style.height="35px",document.querySelector(".emptycell").style.width="35px",$.forEach((e=>{const t=e;t.element.style.left=t.left*J+"px",t.element.style.top=t.top*J+"px",t.element.style.backgroundImage=L,t.element.style.backgroundRepeat="no-repeat",t.element.style.backgroundSize=`${p.value*J}px ${p.value*J}px`,t.element.style.backgroundPosition=`-${t.value%p.value*J}px -${(t.value/p.value|0)*J}px`})),q.element.style.left=q.left*J+"px",q.element.style.top=q.top*J+"px")):document.body.clientWidth>768&&document.body.clientWidth<=1200?(J=60,document.querySelector(".cell")&&(document.querySelectorAll(".cell").forEach((e=>{const t=e;t.style.width="60px",t.style.height="60px"})),document.querySelector(".emptycell").style.height="60px",document.querySelector(".emptycell").style.width="60px",$.forEach((e=>{const t=e;t.element.style.left=t.left*J+"px",t.element.style.top=t.top*J+"px",t.element.style.backgroundImage=L,t.element.style.backgroundRepeat="no-repeat",t.element.style.backgroundSize=`${p.value*J}px ${p.value*J}px`,t.element.style.backgroundPosition=`-${t.value%p.value*J}px -${(t.value/p.value|0)*J}px`})),q.element.style.left=q.left*J+"px",q.element.style.top=q.top*J+"px")):(J=75,document.querySelector(".cell")&&(document.querySelectorAll(".cell").forEach((e=>{const t=e;t.style.width="75px",t.style.height="75px"})),document.querySelector(".emptycell").style.height="75px",document.querySelector(".emptycell").style.width="75px",$.forEach((e=>{const t=e;t.element.style.left=t.left*J+"px",t.element.style.top=t.top*J+"px",t.element.style.backgroundImage=L,t.element.style.backgroundRepeat="no-repeat",t.element.style.backgroundSize=`${p.value*J}px ${p.value*J}px`,t.element.style.backgroundPosition=`-${t.value%p.value*J}px -${(t.value/p.value|0)*J}px`})),q.element.style.left=q.left*J+"px",q.element.style.top=q.top*J+"px")),r.style.width=J*p.value+"px",r.style.height=J*p.value+"px"}function K(e){const t=$[e];if(Math.abs(q.left-t.left)+Math.abs(q.top-t.top)>1)return;G(),t.element.style.left=q.left*J+"px",t.element.style.top=q.top*J+"px";const l=q.left,o=q.top;q.left=t.left,q.top=t.top,q.element.style.left=q.left*J+"px",q.element.style.top=q.top*J+"px",t.left=l,t.top=o;const n=$.every((e=>e.value===e.top*p.value+e.left));N+=1,n&&setTimeout(B,400),V()}G(),window.addEventListener("resize",G),h.addEventListener("click",(function(){F();const l=document.querySelectorAll(".cell");document.querySelector(".emptycell")&&document.querySelector(".emptycell").remove(),N=0,$=[],l.forEach((e=>e.remove())),V(),function(){k&&!0===JSON.parse(localStorage.getItem("gameState"))&&(k=confirm("Do you want to continue saved game?"),k&&!0===JSON.parse(localStorage.getItem("gameState"))&&(p.value=JSON.parse(localStorage.getItem("select")),N=JSON.parse(localStorage.getItem("turns")),V()));let l=function(e,t){const l=.5+85*Math.random();return Math.round(l)}();k&&!0===JSON.parse(localStorage.getItem("gameState"))&&(l=localStorage.getItem("link")),L=`url('./assets/box/${l}.jpg')`,localStorage.setItem("link",l);let o,n,s=[];if(G(),k&&!0===JSON.parse(localStorage.getItem("gameState")))s=JSON.parse(localStorage.getItem("numbers")),o=JSON.parse(localStorage.getItem("numbers"))-1,n=o;else{for(let e=0;e<p.value;e+=1){s[e]=[];for(let t=0;t<p.value;t+=1)e+t!==2*(p.value-1)?s[e][t]=e*p.value+t+1:s[e][t]=""}o=p.value-1,n=p.value-1;for(let e=0;e<1600;e+=1)switch(Math.round(3*Math.random())){case 0:0!==o&&t(s,o,n,o-=1,n);break;case 1:n!==p.value-1&&t(s,o,n,o,n+=1);break;case 2:o!==p.value-1&&t(s,o,n,o+=1,n);break;case 3:0!==n&&t(s,o,n,o,n-=1)}const e=JSON.stringify(s);localStorage.setItem("numbers",e),localStorage.setItem("fieldValue",JSON.stringify(p.value))}let a=0,c=0;for(let t=1;t<=p.value;t+=1){for(let l=1;l<=p.value;l+=1)if(""===s[t-1][l-1]){c+=1;const e=document.createElement("div");e.classList.add("emptycell"),q={value:"",left:(c-1)%p.value,top:(c-1-(c-1)%p.value)/p.value,element:e},k&&(q=JSON.parse(localStorage.getItem("empty")),q.element=e),e.style.left=q.left*J+"px",e.style.top=q.top*J+"px",e.style.width=J+"px",e.style.height=J+"px",r.append(e),e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(()=>{K(document.querySelector(".selected").getAttribute("numId")),document.querySelector(".selected").classList.remove("selected")}))}else{const o=document.createElement("div");o.draggable=!0;const n=s[t-1][l-1]-1;o.classList.add("cell"),o.textContent=n+1,o.style.width=J+"px",o.style.height=J+"px";let u=c%p.value,d=(c-u)/p.value;k&&(u=JSON.parse(localStorage.getItem("cells"))[a].left,d=JSON.parse(localStorage.getItem("cells"))[a].top,a+=1);const m=$.length-1+1;let i,g,y,S;o.style.backgroundImage=L,o.style.backgroundRepeat="no-repeat",o.style.backgroundSize=`${p.value*J}px ${p.value*J}px`,o.style.backgroundPosition=`-${n%p.value*J}px -${(n/p.value|0)*J}px`,o.setAttribute("numId",m),$.push({value:n,left:u,top:d,element:o}),o.style.left=u*J+"px",o.style.top=d*J+"px",c+=1,r.append(o),o.addEventListener("click",(()=>{o.classList.add("selected"),e(document.querySelector(".cellSound")),K(document.querySelector(".selected").getAttribute("numId")),o.classList.remove("selected")})),o.addEventListener("dragstart",(e=>{i=e.pageX,g=e.pageY,y=1*o.style.left.replace("px",""),S=1*o.style.top.replace("px",""),o.classList.add("selected")})),o.addEventListener("dragend",(t=>{o.style.left=y+t.pageX-i,o.style.top=S+t.pageY-g,e(document.querySelector(".cellSound"))}))}O=!0,!0===O?h.textContent="Restart":(h.textContent="Start",N=0,Y())}Y(),M=new Date,k&&(M=new Date(localStorage.getItem("dateObj")),k=!1),localStorage.setItem("dateObj",M),X()}()})),window.addEventListener("unload",(function(){if(O){k=!0;const e=JSON.stringify(N);localStorage.setItem("turns",e),localStorage.setItem("continue",k.toString()),localStorage.setItem("gameState",O),localStorage.setItem("select",JSON.stringify(p.value)),localStorage.setItem("cells",JSON.stringify($)),localStorage.setItem("empty",JSON.stringify(q))}else localStorage.removeItem("turns"),localStorage.removeItem("select"),k=!1,localStorage.setItem("continue",k.toString()),localStorage.setItem("gameState",O)}))})();
//# sourceMappingURL=main.js.map